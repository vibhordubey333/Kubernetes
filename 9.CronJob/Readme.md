### Theory
**1. What are Kubernetes CronJobs?** <br/>
Kubernetes CronJobs are a way to run a task on a time-based schedule and have been around for a long time in Linux and UNIX systems. They are a vital tool for system maintenance and automation. They can be used in to run recurring tasks such as backup jobs, triggering emails, report generation, or automating restarts of containers.

**2. How Do CronJobs Work?**
Traditionally on Unix-based systems, CronJobs work as follows:

   The user creates a cron job by using the crontab command to edit their “crontab” file. This file contains a list of commands or scripts to be executed and the times when they should be executed.
   The cron daemon, a background process that runs continuously, reads the crontab files of all users and checks if any jobs are scheduled to run at the current time.
   If a job is scheduled to run, the cron daemon executes the command or script associated with the job.
   In Kubernetes, CronJobs are automatically managed by the cluster control plane. The cluster creates regular jobs with the pod spec from your CronJob object. CronJobs are a higher-level abstraction than standard K8S jobs that repeat the cycle periodically.

   ![image](https://github.com/vibhordubey333/Kubernetes/assets/22407855/11973a1b-dbdc-4e89-bc43-bb10e34b5ccc)
   ![image](https://github.com/vibhordubey333/Kubernetes/assets/22407855/481053f5-820c-467e-8a72-c3f0e27d0c1b)

**3. Kubernetes CronJobs Monitoring and Considerations**
One CronJob can serve as the model for various jobs, but you may need to adjust it. Here are some considerations when defining a CronJob.

CronJob Concurrency Policy
CronJobs have embedded concurrency controls (a major difference from Unix cron) that let you disable concurrent execution, although Kubernetes enables concurrency by default. With concurrency enabled, a scheduled CronJob run will start even if the last run is incomplete. Concurrency is not desirable for jobs that require sequential execution.

You can control concurrency by configuring the concurrency policy on CronJob objects. You can set one of three values: <br/>

Allow – this is the default setting. <br/>
Forbid – prevents concurrent runs. Kubernetes skips scheduled starts if the last run hasn’t finished. <br/>
Replace – terminates incomplete runs when the next job is scheduled, allowing the new run to proceed. <br/>

3. When should you use Kubernetes CronJobs? (Benefits, Advantages)
The main advantage and benefit of using a CronJob in Kubernetes is that it allows you to automate recurring tasks, such as backups, data synchronization, batch processing, and maintenance jobs. You should use them anywhere applicable where they are the most appropriate option to save manual effort.

**Some common use cases for Cronjobs in K8S include:**

1. **Data backup**
Schedule periodic backups of data within your applications or databases, ensuring that important data is regularly saved to a persistent storage or external location.

2. **Database maintenance**
Automate tasks such as database cleanup, reindexing, or data migration on a regular basis to maintain database performance and data integrity.

3. **Log rotation and cleanup**
Rotate and manage log files generated by applications to prevent log files from growing too large, which can impact system performance and storage space.

4. **Certificate renewal**
Automate the renewal of SSL/TLS certificates, ensuring that your applications always use up-to-date and valid certificates for secure communication.

5. **Data synchronization**
Periodically synchronize data between different systems or databases to keep information up-to-date across services.

6. **Scheduled reports**
Generate and send scheduled reports, such as daily, weekly, or monthly summaries, to users or stakeholders.

7. **Batch processing**
Run batch jobs for processing large volumes of data at specific intervals, such as nightly data aggregations, ETL (Extract, Transform, Load) processes, or data import/export tasks.

8. **Scheduled cleanup**
Automate the removal of temporary files, outdated data, or other resources to maintain system cleanliness and prevent resource exhaustion. You could also use a Cronjob to regularly clean up unused or expired resources to optimize resource utilization and reduce costs.

9. **Maintenance tasks**
Schedule routine maintenance tasks for your applications, such as database schema updates, software updates, or health checks.

10. **Resource scaling**
Scale application resources up or down based on demand, such as increasing the number of worker nodes during peak hours and reducing them during off-peak times.

11. **Security scanning**
Run regular security scans and vulnerability assessments on your applications and infrastructure to identify and mitigate security risks.

12. **Monitoring and alerts**
Automate the collection of metrics, logs, and system health checks at specific intervals, and trigger alerts or actions based on the collected data.

13. **Content publishing**
Schedule content publishing or updates for websites, blogs, or content management systems.

14. **Compliance audits**
Automate compliance checks and audits to ensure that your applications and infrastructure meet regulatory requirements.

15. **Cache invalidation**
Invalidate caches or perform cache purges on a predefined schedule to ensure that applications serve the latest data to users.

### Demonstration:

1. To apply `kubectl apply -f cronjob.yaml`
2. To check cronjob
   
   ```
   vibhor@vibhor-virtualbox:~/code-repositories/Kubernetes/9.CronJob (master *%)$ kubectl get cronjob -n work
    NAME    SCHEDULE    SUSPEND   ACTIVE   LAST SCHEDULE   AGE
    hello   * * * * *   False     0        29s             45s
    ```
3.  To check pod which cronjob has created

```
vibhor@vibhor-virtualbox:~/code-repositories/Kubernetes/9.CronJob (master *%)$ kubectl get po -n work
NAME                           READY   STATUS      RESTARTS      AGE
demo-web-page-7d44d8fd-jztqq   1/1     Running     1 (18h ago)   43h
demo-web-page-7d44d8fd-rx4l5   1/1     Running     1 (18h ago)   43h
hello-28443395-42mcr           0/1     Completed   0             74s
hello-28443396-5khbq           0/1     Completed   0             14s
```

4. To check jobs in realtime:

```
vibhor@vibhor-virtualbox:~/code-repositories/Kubernetes (master)$ kubectl get jobs -n work --watch
NAME             COMPLETIONS   DURATION   AGE
hello-28443402   1/1           3m48s      4m48s
hello-28443405   1/1           15s        67s
hello-28443406   1/1           4s         48s
```

5. To check logs of cron jobs

```
vibhor@vibhor-virtualbox:~/code-repositories/Kubernetes/9.CronJob (master)$ kubectl get po -n work
NAME                           READY   STATUS      RESTARTS      AGE
demo-web-page-7d44d8fd-jztqq   1/1     Running     1 (19h ago)   43h
demo-web-page-7d44d8fd-rx4l5   1/1     Running     1 (19h ago)   43h
hello-28443428-kq8n9           0/1     Completed   0             114s
hello-28443429-zt42r           0/1     Completed   0             69s
hello-28443430-kxtc2           0/1     Completed   0             5s
```

```
vibhor@vibhor-virtualbox:~/code-repositories/Kubernetes/9.CronJob (master)$ kubectl logs hello-28443430-kxtc2 -n work
Tue Jan 30 09:10:06 UTC 2024
Hello from the Kubernetes cluster

```
   
### References:
  -  https://medium.com/@pranay.shah/how-to-get-logs-from-cron-job-in-kubernetes-last-completed-job-7957327c7e76
  -  https://spacelift.io/blog/kubernetes-cronjob
  -  https://komodor.com/learn/kubernetes-cronjobs/

### Cron Issues
  -  https://stackoverflow.com/questions/75974501/kubernetes-finding-logs-of-a-failed-cronjob

